System.register(["jimu-core","jimu-arcgis"],(function(e,t){var r={},n={};return{setters:[function(e){r.DataSourceComponent=e.DataSourceComponent,r.React=e.React,r.getAppStore=e.getAppStore,r.jsx=e.jsx},function(e){n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules}],execute:function(){e((()=>{var e={826:e=>{"use strict";e.exports=n},891:e=>{"use strict";e.exports=r}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,o),a.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var a={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(a),o.d(a,{__set_webpack_public_path__:()=>u,default:()=>n});var e=o(891),t=o(826),r=function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function u(e){try{c(n.next(e))}catch(e){a(e)}}function i(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,i)}c((n=n.apply(e,t||[])).next())}))};function n(n){var o;const{username:a,fullName:u,lastLogin:i,role:c,created:s}=n.user,{name:l,title:d,id:p,type:f,owner:v}=(0,e.getAppStore)().getState().appInfo,m=null===(o=n.useDataSources)||void 0===o?void 0:o[0],y=e.React.useRef(null),[g,w]=e.React.useState(!1),S=e.React.useRef({duration:0}),h=e.React.useRef(null),D=e.React.useRef(null),R=e.React.useRef(null);let b=1,E=!0;const L=()=>r(this,void 0,void 0,(function*(){if(y.current)try{const e=(yield y.current.applyEdits({addFeatures:[{geometry:{type:"point",x:0,y:0,spatialReference:{wkid:4326}},attributes:{portalname:n.config.portalName||l||d,username:a,fullname:u||"",datestr:new Date(i).toLocaleString("ru-RU"),dateint:Math.floor(new Date(i).getTime()/1e3),dateinstr:(new Date).toLocaleString("ru-RU"),dateinint:Math.floor(Date.now()/1e3),dateoutstr:"0",dateoutint:0,duration:S.current.duration,role:c||"custom",createdstr:new Date(s).toLocaleString("ru-RU"),createdint:Math.floor(new Date(s).getTime()/1e3),portaltype:f,portalid:p,portalowner:v}}]})).addFeatureResults[0];if(e.error)throw new Error(e.error.message);return console.log("‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"),e.objectId}catch(e){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏:",e.message||e)}else console.warn("‚ö†Ô∏è featureLayer –µ—â—ë –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω ‚Äî addNewFeatures –ø—Ä–æ–ø—É—â–µ–Ω")}));return e.React.useEffect((()=>{if(!g)return;E=!0;const e=()=>{E&&(b=1,clearTimeout(h.current),h.current=setTimeout((()=>r(this,void 0,void 0,(function*(){E&&y.current&&(b=0,S.current.dateoutstr=(new Date).toLocaleString("ru-RU"),S.current.dateoutint=Math.floor(Date.now()/1e3),yield y.current.applyEdits({updateFeatures:[{attributes:S.current}]}))}))),5e3))},t=()=>r(this,void 0,void 0,(function*(){E&&y.current&&(document.hidden?(b=0,clearTimeout(h.current),S.current.dateoutstr=(new Date).toLocaleString("ru-RU"),S.current.dateoutint=Math.floor(Date.now()/1e3)):(b=1,e(),S.current.dateinstr=(new Date).toLocaleString("ru-RU"),S.current.dateinint=Math.floor(Date.now()/1e3)),yield y.current.applyEdits({updateFeatures:[{attributes:S.current}]}))})),n=["mousedown","mousemove","keypress","scroll"];return n.forEach((t=>document.addEventListener(t,e))),document.addEventListener("visibilitychange",t),window.addEventListener("beforeunload",(e=>r(this,void 0,void 0,(function*(){y.current&&(S.current.dateoutstr=(new Date).toLocaleString("ru-RU"),S.current.dateoutint=Math.floor(Date.now()/1e3),yield y.current.applyEdits({updateFeatures:[{attributes:S.current}]}),e.preventDefault(),e.returnValue="")})))),t(),D.current=setInterval((()=>{E&&(S.current.duration+=b,console.log("‚è± duration:",S.current.duration))}),1e3),R.current=setInterval((()=>r(this,void 0,void 0,(function*(){if(E&&y.current)try{yield y.current.applyEdits({updateFeatures:[{attributes:S.current}]})}catch(e){console.warn("‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–≤–æ–∑–º–æ–∂–Ω–æ, –≤–∏–¥–∂–µ—Ç —É–¥–∞–ª—ë–Ω)")}}))),1e4),()=>{E=!1,clearInterval(D.current),clearInterval(R.current),clearTimeout(h.current),n.forEach((t=>document.removeEventListener(t,e))),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",(()=>{})),console.log("üßπ Widget —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω ‚Äî –≤—Å—ë –æ—á–∏—â–µ–Ω–æ")}}),[g]),(0,e.jsx)(e.DataSourceComponent,{useDataSource:m,onDataSourceCreated:e=>r(this,void 0,void 0,(function*(){var r;try{const[o]=yield(0,t.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]),i=(null===(r=e.getUrl)||void 0===r?void 0:r.call(e))||e.url;if(!i)throw new Error("URL —Å–ª–æ—è –Ω–µ –Ω–∞–π–¥–µ–Ω");y.current=new o({url:i});const c=(new Date).toLocaleDateString("ru-RU"),s=yield e.query({where:`portalname = '${n.config.portalName||l||d}' AND username = '${a}' AND fullname = '${u}' AND datestr LIKE '${c}%'`,outFields:["objectid","dateinint","dateinstr","dateoutint","dateoutstr","duration"],returnGeometry:!0,orderByFields:["dateoutint DESC","dateinint DESC"]});s.records.length?(console.log("üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏"),S.current=Object.assign({},s.records[0].getData()),S.current.dateinstr=(new Date).toLocaleString("ru-RU"),S.current.dateinint=Math.floor(Date.now()/1e3),yield y.current.applyEdits({updateFeatures:[{attributes:S.current}]})):(console.log("üÜï –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî —Å–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å—å"),yield L()),w(!0)}catch(e){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö:",e.message||e)}}))})}function u(e){o.p=e}})(),a})())}}}));