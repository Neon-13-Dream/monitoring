System.register(["jimu-core/react","jimu-ui","jimu-core","jimu-arcgis"],(function(e,t){var n={},r={},o={},a={};return{setters:[function(e){n.default=e.default,n.useState=e.useState},function(e){r.Button=e.Button,r.Loading=e.Loading},function(e){o.DataSourceComponent=e.DataSourceComponent,o.DataSourceManager=e.DataSourceManager,o.getAppStore=e.getAppStore},function(e){a.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules}],execute:function(){e((()=>{var e={826:e=>{"use strict";e.exports=a},891:e=>{"use strict";e.exports=o},315:e=>{"use strict";e.exports=n},726:e=>{"use strict";e.exports=r}},t={};function l(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,l),o.exports}l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var u={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(u),l.d(u,{__set_webpack_public_path__:()=>i,default:()=>a});var e=l(315),t=l(726),n=l(891),r=l(826),o=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function l(e){try{i(r.next(e))}catch(e){a(e)}}function u(e){try{i(r.throw(e))}catch(e){a(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,u)}i((r=r.apply(e,t||[])).next())}))};function a(a){var l,u,i,c;console.log((0,n.getAppStore)().getState()),console.log((0,n.getAppStore)().getState().appConfig.name);const s=a.user,d=(null===(l=a.user)||void 0===l?void 0:l.username)||(null===(u=a.user)||void 0===u?void 0:u.fullName)||"Anonymous",f=null===(i=a.useDataSources)||void 0===i?void 0:i[0],[p,g]=(0,e.useState)(!1),m=e=>o(this,void 0,void 0,(function*(){var t,n;if(!e||!s)return void alert("Ошибка: не подключён слой или пользователь");g(!0);const o={geometry:{type:"point",x:0,y:0,spatialReference:{wkid:4326}},attributes:{portal:(null===(t=s.appInfo)||void 0===t?void 0:t.appTitle)||"Unknown Portal",username:d,fullname:s.fullName||"",datestr:new Date(s.lastLogin).toLocaleString("ru-RU"),dateint:Math.floor(new Date(s.lastLogin).getTime()/1e3),dateinstr:(new Date).toLocaleString("ru-RU"),dateinint:Math.floor((new Date).getTime()/1e3),dateoutstr:"0",dateoutint:0,duration:0,role:s.role||"custom",createdstr:new Date(s.created).toLocaleString("ru-RU"),createdint:Math.floor(new Date(s.created).getTime()/1e3)}};try{const[t]=yield(0,r.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]),l=(null===(n=e.getUrl)||void 0===n?void 0:n.call(e))||e.url;if(!l)throw new Error("URL слоя не найден");const u=new t({url:l}),i=(yield u.applyEdits({addFeatures:[o]})).addFeatureResults[0];if(i.error)throw new Error(i.error.message);console.log("Успешно добавлено 123123123123123123:",i,a),alert("Данные пользователя записаны!")}catch(e){console.error("Ошибка:",e),alert("Ошибка: "+(e.message||"Неизвестная ошибка"))}finally{g(!1)}}));return e.default.createElement("div",{style:{padding:16}},e.default.createElement(n.DataSourceComponent,{useDataSource:f}),e.default.createElement("h4",null,"Лог входа (UZ)"),e.default.createElement("p",null,e.default.createElement("strong",null,"Пользователь:")," ",(null==s?void 0:s.fullName)||"—"),e.default.createElement("p",null,e.default.createElement("strong",null,"Логин:")," ",d),e.default.createElement("p",null,e.default.createElement("strong",null,"Портал:")," ",(null===(c=null==s?void 0:s.appInfo)||void 0===c?void 0:c.appTitle)||"—"),e.default.createElement("p",null,e.default.createElement("strong",null,"Роль:")," ",(null==s?void 0:s.role)||"—"),e.default.createElement(t.Button,{type:"primary",onClick:()=>{console.log(a.appConfig),console.log(a.user);const e=n.DataSourceManager.getInstance().getDataSource(null==f?void 0:f.dataSourceId);e&&m(e)},disabled:p},p?e.default.createElement(t.Loading,{type:"SECONDARY"}):"Записать вход"),e.default.createElement("p",null,e.default.createElement("strong",null,"Роль:")," ",JSON.stringify(a,null,2)),e.default.createElement("p",null,e.default.createElement("strong",null,"Роль:")," ",JSON.stringify(a.user,null,2)))}function i(e){l.p=e}})(),u})())}}}));