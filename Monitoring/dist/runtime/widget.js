System.register(["jimu-core/react","jimu-ui","jimu-core","jimu-arcgis"],(function(e,t){var n={},r={},a={},o={};return{setters:[function(e){n.default=e.default,n.useState=e.useState},function(e){r.Button=e.Button,r.Loading=e.Loading},function(e){a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager},function(e){o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules}],execute:function(){e((()=>{var e={826:e=>{"use strict";e.exports=o},891:e=>{"use strict";e.exports=a},315:e=>{"use strict";e.exports=n},726:e=>{"use strict";e.exports=r}},t={};function l(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,l),a.exports}l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var u={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(u),l.d(u,{__set_webpack_public_path__:()=>i,default:()=>o});var e=l(315),t=l(726),n=l(891),r=l(826),a=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function l(e){try{i(r.next(e))}catch(e){o(e)}}function u(e){try{i(r.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,u)}i((r=r.apply(e,t||[])).next())}))};function o(o){var l,u,i,c;const d=o.user,s=(null===(l=o.user)||void 0===l?void 0:l.username)||(null===(u=o.user)||void 0===u?void 0:u.fullName)||"Anonymous",f=null===(i=o.useDataSources)||void 0===i?void 0:i[0],[p,m]=(0,e.useState)(!1),g=e=>a(this,void 0,void 0,(function*(){var t,n;if(!e||!d)return void alert("Ошибка: не подключён слой или пользователь");m(!0);const a={geometry:{type:"point",x:0,y:0,spatialReference:{wkid:4326}},attributes:{portal:(null===(t=d.appInfo)||void 0===t?void 0:t.appTitle)||"Unknown Portal",username:s,fullname:d.fullName||"",datestr:new Date(d.lastLogin).toLocaleString("ru-RU"),dateint:Math.floor(new Date(d.lastLogin).getTime()/1e3),dateinstr:(new Date).toLocaleString("ru-RU"),dateinint:Math.floor((new Date).getTime()/1e3),dateoutstr:"0",dateoutint:0,duration:0,role:d.role||"custom",createdstr:new Date(d.created).toLocaleString("ru-RU"),createdint:Math.floor(new Date(d.created).getTime()/1e3)}};try{const[t]=yield(0,r.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]),l=(null===(n=e.getUrl)||void 0===n?void 0:n.call(e))||e.url;if(!l)throw new Error("URL слоя не найден");const u=new t({url:l}),i=(yield u.applyEdits({addFeatures:[a]})).addFeatureResults[0];if(i.error)throw new Error(i.error.message);console.log("Успешно добавлено 123123123123123123:",i,o),alert("Данные пользователя записаны!")}catch(e){console.error("Ошибка:",e),alert("Ошибка: "+(e.message||"Неизвестная ошибка"))}finally{m(!1)}}));return e.default.createElement("div",{style:{padding:16}},e.default.createElement(n.DataSourceComponent,{useDataSource:f}),e.default.createElement("h4",null,"Лог входа (UZ)"),e.default.createElement("p",null,e.default.createElement("strong",null,"Пользователь:")," ",(null==d?void 0:d.fullName)||"—"),e.default.createElement("p",null,e.default.createElement("strong",null,"Логин:")," ",s),e.default.createElement("p",null,e.default.createElement("strong",null,"Портал:")," ",(null===(c=null==d?void 0:d.appInfo)||void 0===c?void 0:c.appTitle)||"—"),e.default.createElement("p",null,e.default.createElement("strong",null,"Роль:")," ",(null==d?void 0:d.role)||"—"),e.default.createElement(t.Button,{type:"primary",onClick:()=>{console.log(o),console.log(o.user);const e=n.DataSourceManager.getInstance().getDataSource(null==f?void 0:f.dataSourceId);e&&g(e)},disabled:p},p?e.default.createElement(t.Loading,{type:"SECONDARY"}):"Записать вход"),e.default.createElement("p",null,e.default.createElement("strong",null,"Роль:")," ",JSON.stringify(o,null,2)),e.default.createElement("p",null,e.default.createElement("strong",null,"Роль:")," ",JSON.stringify(o.user,null,2)))}function i(e){l.p=e}})(),u})())}}}));