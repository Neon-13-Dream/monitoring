System.register(["jimu-core/react","jimu-ui","jimu-core","jimu-arcgis"],(function(e,t){var r={},n={},o={},a={};return{setters:[function(e){r.default=e.default,r.useState=e.useState},function(e){n.Button=e.Button,n.Loading=e.Loading},function(e){o.DataSourceComponent=e.DataSourceComponent,o.DataSourceManager=e.DataSourceManager},function(e){a.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules}],execute:function(){e((()=>{var e={826:e=>{"use strict";e.exports=a},891:e=>{"use strict";e.exports=o},315:e=>{"use strict";e.exports=r},726:e=>{"use strict";e.exports=n}},t={};function l(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,l),o.exports}l.d=(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var u={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(u),l.d(u,{__set_webpack_public_path__:()=>i,default:()=>a});var e=l(315),t=l(726),r=l(891),n=l(826),o=function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function l(e){try{i(n.next(e))}catch(e){a(e)}}function u(e){try{i(n.throw(e))}catch(e){a(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(l,u)}i((n=n.apply(e,t||[])).next())}))};function a(a){var l,u,i,c;const d=a.user,s=(null===(l=a.user)||void 0===l?void 0:l.username)||(null===(u=a.user)||void 0===u?void 0:u.fullName)||"Anonymous",f=null===(i=a.useDataSources)||void 0===i?void 0:i[0],[p,m]=(0,e.useState)(!1),g=e=>o(this,void 0,void 0,(function*(){var t,r;if(!e||!d)return void alert("Ошибка: не подключён слой или пользователь");m(!0);const o={geometry:{type:"point",x:0,y:0,spatialReference:{wkid:4326}},attributes:{portal:(null===(t=d.appInfo)||void 0===t?void 0:t.appTitle)||"Unknown Portal",username:s,fullname:d.fullName||"",datestr:new Date(d.lastLogin).toLocaleString("ru-RU"),dateint:Math.floor(new Date(d.lastLogin).getTime()/1e3),dateinstr:(new Date).toLocaleString("ru-RU"),dateinint:Math.floor((new Date).getTime()/1e3),dateoutstr:"0",dateoutint:0,duration:0,role:d.role||"custom",createdstr:new Date(d.created).toLocaleString("ru-RU"),createdint:Math.floor(new Date(d.created).getTime()/1e3)}};try{const[t]=yield(0,n.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]),l=(null===(r=e.getUrl)||void 0===r?void 0:r.call(e))||e.url;if(!l)throw new Error("URL слоя не найден");const u=new t({url:l}),i=(yield u.applyEdits({addFeatures:[o]})).addFeatureResults[0];if(i.error)throw new Error(i.error.message);console.log("Успешно добавлено:",i),console.log(a),alert("Данные пользователя записаны!")}catch(e){console.error("Ошибка:",e),alert("Ошибка: "+(e.message||"Неизвестная ошибка"))}finally{m(!1)}}));return e.default.createElement("div",{style:{padding:16}},e.default.createElement(r.DataSourceComponent,{useDataSource:f}),e.default.createElement("h4",null,"Лог входа (UZ)"),e.default.createElement("p",null,e.default.createElement("strong",null,"Пользователь:")," ",(null==d?void 0:d.fullName)||"—"),e.default.createElement("p",null,e.default.createElement("strong",null,"Логин:")," ",s),e.default.createElement("p",null,e.default.createElement("strong",null,"Портал:")," ",(null===(c=null==d?void 0:d.appInfo)||void 0===c?void 0:c.appTitle)||"—"),e.default.createElement("p",null,e.default.createElement("strong",null,"Роль:")," ",(null==d?void 0:d.role)||"—"),e.default.createElement(t.Button,{type:"primary",onClick:()=>{const e=r.DataSourceManager.getInstance().getDataSource(null==f?void 0:f.dataSourceId);e&&g(e)},disabled:p},p?e.default.createElement(t.Loading,{type:"SECONDARY"}):"Записать вход"))}function i(e){l.p=e}})(),u})())}}}));