System.register(["jimu-core","jimu-arcgis"],(function(e,t){var r={},n={};return{setters:[function(e){r.DataSourceComponent=e.DataSourceComponent,r.React=e.React,r.getAppStore=e.getAppStore,r.jsx=e.jsx},function(e){n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules}],execute:function(){e((()=>{var e={826:e=>{"use strict";e.exports=n},891:e=>{"use strict";e.exports=r}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,o),a.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var a={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(a),o.d(a,{__set_webpack_public_path__:()=>u,default:()=>n});var e=o(891),t=o(826),r=function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function u(e){try{c(n.next(e))}catch(e){a(e)}}function i(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,i)}c((n=n.apply(e,t||[])).next())}))};function n(n){var o;const{username:a,fullName:u,lastLogin:i,role:c,created:s}=n.user,{name:d,title:l,id:p,type:f,owner:m}=(0,e.getAppStore)().getState().appInfo,g=null===(o=n.useDataSources)||void 0===o?void 0:o[0],v=e.React.useRef(),w=e.React.useRef({duration:0}),y=e.React.useRef(),S=e.React.useRef(),h=e.React.useRef();var D=1;const R=()=>r(this,void 0,void 0,(function*(){try{const e=(yield v.current.applyEdits({addFeatures:[{geometry:{type:"point",x:0,y:0,spatialReference:{wkid:4326}},attributes:{portalname:n.config.portalName||d||l,username:a,fullname:u||"",datestr:new Date(i).toLocaleString("ru-RU"),dateint:Math.floor(new Date(i).getTime()/1e3),dateinstr:(new Date).toLocaleString("ru-RU"),dateinint:Math.floor((new Date).getTime()/1e3),dateoutstr:"0",dateoutint:0,duration:w.current.duration,role:c||"custom",createdstr:new Date(s).toLocaleString("ru-RU"),createdint:Math.floor(new Date(s).getTime()/1e3),portaltype:f,portalid:p,portalowner:m}}]})).addFeatureResults[0];if(e.error)throw new Error(e.error.message);return e.objectId}catch(e){console.error("ÐžÑˆÐ¸Ð±ÐºÐ°:",e),console.error("ÐžÑˆÐ¸Ð±ÐºÐ°: "+(e.message||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°"))}}));return e.React.useEffect((()=>{console.log(n),console.log((0,e.getAppStore)().getState().appInfo);const t=()=>{D=1,clearTimeout(y.current),y.current=setTimeout((()=>{D=0,w.current.dateoutstr=(new Date).toLocaleString("ru-RU"),w.current.dateoutint=Math.floor((new Date).getTime()/1e3)}),5e3)},o=()=>r(this,void 0,void 0,(function*(){document.hidden?(D=0,clearTimeout(y.current),w.current.dateoutstr=(new Date).toLocaleString("ru-RU"),w.current.dateoutint=Math.floor((new Date).getTime()/1e3)):(D=1,t(),w.current.dateinstr=(new Date).toLocaleString("ru-RU"),w.current.dateinint=Math.floor((new Date).getTime()/1e3))}));o();const a=["mousedown","mousemove","keypress","scroll"];return a.forEach((e=>document.addEventListener(e,t))),document.addEventListener("visibilitychange",o),window.addEventListener("beforeunload",(e=>{v.current&&(w.current.dateoutstr=(new Date).toLocaleString("ru-RU"),w.current.dateoutint=Math.floor((new Date).getTime()/1e3),v.current.applyEdits({updateFeatures:[{attributes:w.current}]}),e.preventDefault(),e.returnValue="")})),S.current=setInterval((()=>{w.current.duration+=D,console.log(w.current.duration)}),1e3),h.current=setInterval((()=>r(this,void 0,void 0,(function*(){try{yield v.current.applyEdits({updateFeatures:[{attributes:w.current}]})}catch(e){console.warn("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ (Ð²Ð¸Ð´Ð¶ÐµÑ‚ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ ÑƒÐ´Ð°Ð»Ñ‘Ð½).")}}))),5e3),()=>{clearInterval(S.current),clearInterval(h.current),clearTimeout(y.current),a.forEach((e=>document.removeEventListener(e,t))),document.removeEventListener("visibilitychange",o),window.removeEventListener("beforeunload",(()=>{})),console.log("ðŸ§¹ LogUserEntry unmounted â€” Ñ‚Ð°Ð¹Ð¼ÐµÑ€Ñ‹ Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½Ñ‹")}}),[]),(0,e.jsx)(e.DataSourceComponent,{useDataSource:g,onDataSourceCreated:e=>r(this,void 0,void 0,(function*(){var o;const[u]=yield(0,t.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]),i=(null===(o=e.getUrl)||void 0===o?void 0:o.call(e))||e.url;if(!i)throw new Error("URL ÑÐ»Ð¾Ñ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½");v.current=new u({url:i}),yield e.query({where:`portalname = '${n.config.portalName||d||l}' AND username = '${a}' AND datestr LIKE '${(new Date).toLocaleDateString()}%'`,outFields:["objectid","dateinint","dateinstr","dateoutint","dateoutstr","duration"],returnGeometry:!0,orderByFields:["dateoutint DESC","dateinint DESC"]}).then((e=>r(this,void 0,void 0,(function*(){e.records.length?(console.log("Old User"),w.current=Object.assign({},e.records[0].getData()),w.current.dateinstr=(new Date).toLocaleString("ru-RU"),w.current.dateinint=Math.floor((new Date).getTime()/1e3),yield v.current.applyEdits({updateFeatures:[{attributes:w.current}]})):(console.log("New User"),R())}))))}))})}function u(e){o.p=e}})(),a})())}}}));